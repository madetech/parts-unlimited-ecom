<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="progress-bar.css"/>
    <link rel="stylesheet" href="items-details.css">
  </head>
  <body class="bg-light" >
    <div class="container p-3">
      <div class="row">
        <div class="col-1"></div>
        <div class="col-10">
          <div class="container-progress">
            <ul class="progressbar">
              <li>Customer</li>
              <li class="active">Items</li>
              <li>Summary</li>
            </ul>
          </div>
        </div>
        <div class="col-1"></div>
      </div>
      <div class="row">
        <div class="col-1"></div>
        <div class="col-10 pt-5">
          <table class="table table-striped border rounded bg-white">
            <thead>
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity</th>
                <th scope="col">Total</th>
                <th scope="col"></th>
              </tr>
            </thead>
            <tbody>
              <% @items.each_with_index do |item, index| %>
              <tr>
                <td class="width-15"><%= item[:id] %></td>
                <td class="width-45"><%= item[:name] %></td>
                <td class="width-10" ><%= item[:price] %></td>
                <td class="width-10" ><%= item[:quantity] %></td>
                <td class="width-10" ><%= item[:total] %></td>
                <td class="width-10" >
                  <form method="POST" action="/item-delete/<%= index %>"><button class="btn btn-danger pt-1 pb-1 float_right">Delete</button></form>
                </td>
              </tr>
              <% end %>
            </tbody>
          </table>
          <h6 class="float-right p-3"> Net Total: Â£<%= @net_total %> </h6>
        </div>
        <div class="col-1"></div>
      </div>
      <div class="row">
        <div class="col-1"></div>
        <div class="col-10">
          <form method="POST" action="/items-details" id="new-row">
            <div class="form-row">
              <div class="p-1 pl-3 width-14">
                <% if @errors.include?(:missing_id)%>
                <input type="text" id="id" name="id" class="form-control is-invalid" placeholder="ID"/>
                <% elsif @item_row.nil? %>
                <input type="text" id="id" name="id" class="form-control" placeholder="ID"/>
                <% else %>
                <input type="text" id="id" name="id" class="form-control" value="<%= @item_row[:id]%>"/>
                <% end %>
              </div>
              <div class="p-1 width-45">
                <%if @errors.include?(:missing_name)%>
                <input type="text" id="name" name="name" class="form-control is-invalid" placeholder="Name"/>
                <% elsif @item_row.nil? %>
                <input type="text" id="name" name="name" class="form-control" placeholder="Name"/>
                <% else %>
                <input type="text" id="name" name="name" class="form-control" value="<%= @item_row[:name]%>"/>
                <% end %>
              </div>
              <div class="p-1 width-10">
                <% if @errors.include?(:missing_price) || @errors.include?(:invalid_price)%>
                <input type="text" pattern="^[0-9]+(\.[0-9]+)?$" id="price" name="price" class="form-control is-invalid" placeholder="Price"/>
                <% elsif @item_row.nil? %>
                <input type="text" pattern="^[0-9]+(\.[0-9]+)?$" id="price" name="price" class="form-control" placeholder="Price"/>
                <% else %>
                <input type="text" pattern="^[0-9]+(\.[0-9]+)?$" id="price" name="price" class="form-control" value="<%= @item_row[:price]%>"/>
                <% end %>
              </div>
              <div class="p-1 width-11">
                <%if @errors.include?(:missing_quantity) || @errors.include?(:invalid_quantity)%>
                <input type="text" pattern="^[0-9]+(\.[0-9]+)?$" id="quantity" name="quantity" class="form-control is-invalid" placeholder="Quantity"/>
                <% elsif @item_row.nil? %>
                <input type="text" pattern="^[0-9]+(\.[0-9]+)?$" id="quantity" name="quantity" class="form-control" placeholder="Quantity"/>
                <% else %>
                <input type="text" pattern="^[0-9]+(\.[0-9]+)?$" id="quantity" name="quantity" class="form-control" value="<%= @item_row[:quantity]%>"/>
                <% end %>
              </div>
              <div class="pl-5 pt-1 width-20">
                <button type="submit" class="btn btn-primary float_right width-70">Add</button>
              </div>
            </div>
          </form>
              <% pretty_error_message_conversion = { 
                missing_id: 'Please enter a product ID', 
                missing_name: 'Please enter a product name',
                missing_price: 'Please enter a price',
                missing_quantity: 'Please enter a quantity',
                invalid_price: 'Please enter a valid price',
                invalid_quantity: 'Please enter a quantity'
                } %>
              <p class="text-danger pl-2">
              <% @errors.each do |error|%>
                <% next if error == :invalid_quantity && @errors.include?(:missing_quantity) %>
                <% next if error == :invalid_price && @errors.include?(:missing_price) %>
                *<%= pretty_error_message_conversion[error] %><br/>
              <% end %>
              </p>
        </div>
        <div class="col-1"></div>
      </div>
      <div class="row">
        <div class="col p-4 pb-5">
          <a role="button" href="/customer-details" class="btn btn-secondary ml-3">Back</a>
          <a role="button" href="/order-summary" class="btn btn-primary float-right mr-3">Next</a>
        </div>
      </div>
    </div>
  </body>
</html>
